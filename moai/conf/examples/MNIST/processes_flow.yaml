# @package _global_

_moai_:
  _initialize_:  # responsible for initializers
    fit:
      setup: [default] # used only at the beginning of the training process
      # batch: [default] # used at the beginning of each batch
      # epoch: [default] # used at the beginning of each epoch
    test:
      setup: pretrained
    predict:
      setup: pretrained
  _flows_: # that will be used in the main process
    encoder:
      input: [color]
      out:  [prediction]
    postprocess:
      argmax:
        tensor: [prediction]
        out:  [predicted_label]
  _execution_: # forces execution of the following flows
    fit:
      batch:
        train_encoder:
          optimizer: train_encoder
          objective: train_encoder
          steps:
            - encoder
    test:
      batch:
        train_encoder:
          steps:
            - encoder
            - postprocess
    predict: # used for torchserve
      batch:
        train_encoder:
          steps:
            - encoder
            - postprocess
    val:
      batch:
        mnist: &val_proc
          train_encoder:
            steps:
              - encoder
              - postprocess
        mnist_2: *val_proc
  _schedule_:
    - epoch: 1
      process:
        train_encoder:
          optimizer: train_encoder
          objective: train_encoder
          steps:
            - encoder
            - postprocess