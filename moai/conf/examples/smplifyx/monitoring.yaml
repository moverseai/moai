# @package _global_

_moai_:
  _collections_:
    _monitors_:
      save_params:
        append_pkl:
          path: ['.', '.hydra']
          keys: 
            -
              - translation
              - embedding
              - body.betas
              - body.rotation
              - body.left_hand
              - body.right_hand
              - body.jaw
              - body.pose
              - body.expression
            - 
              - body.pose
        pkl:
          params:
            path: '.'
            keys: 
              - translation
              - embedding
              - body.betas
              - body.rotation
              - body.left_hand
              - body.right_hand
              - body.jaw
              - body.pose
              - body.expression
      show_optim_step:
        mesh:
          vertices: [body.vertices]
          faces: [body.faces]
          params:
            color: green
            path: /fit/body/mesh/step
        keypoints:
          keypoints: [split_joints2d.body, split_keypoints.body]
          path: [/fit/image/body/joints2d, /fit/image/keypoints2d]
          skeleton: [openpose, openpose_gt]
          color: [red, green]
        optimization_losses:
          params:
            path: /plots
            keys: [gm_j2d, vposer, shape, bend, total]
      show_image:
        posed_image:
          image: [color]
          pose: [null]
          params:
            path: /fit/image
        # mesh3d:
        #   vertices: [body.vertices, body.vertices]
        #   faces: [body.faces, body.faces]
        #   color: [green, blue]
        #   path: [fit/body/mesh/step, fit/body/mesh/step2]
      show_mesh_iter:
        mesh:
          vertices: [body.vertices]
          faces: [body.faces]
          params:
            color: cyan
            path: /fit/body/mesh/iter
      show_mesh_batch:
        mesh:
          vertices: [translated_vertices] # [body.vertices]
          faces: [body.faces]
          params:
            color: red
            path: /fit/body/mesh/batch
    _metrics_:
      fit_quality:
        # frequency: 1
        rmse:
          gt: [keypoints]
          pred: [joints2d]
          out: [rmse]
  _monitoring_:
    fit:
      step:
        # initialize_translation:
        #   frequency: 1
        #   # steps:
        #     # - show_mesh
        #   tensors:
        #     # - save_params
        #     # - show_mesh_step            
        #     - show_image
        initial_torso_fit:
          tensors: [show_optim_step]
        fine_fit_stage1:
          tensors: [show_optim_step]
      iter:
        initialize_torso:
          tensors: [show_image]
        initial_torso_fit:
          frequency: 1
        #   # steps:
        #     # - show_mesh
          tensors: [show_mesh_iter]
        #   metrics:
        #     - fit_quality
        #   termination: [bad_fit, error]
        fine_fit_stage1:
          frequency: 1
          tensors: [show_mesh_iter]
          metrics: [fit_quality]
          termination: [bad_fit, error]
      batch:
        log_results:
          frequency: 1
          # steps: []
          metrics:
            - fit_quality
          tensors:
            - show_mesh_batch