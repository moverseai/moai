# @package _global_

_moai_:
  _collections_:
    _monitors_:
      save_params:
        append_pkl:
          path: ['.', '.hydra']
          keys: 
            -
              - translation
              - embedding
              - body.betas
              - body.rotation
              - body.left_hand
              - body.right_hand
              - body.jaw
              - body.pose
              - body.expression
            - 
              - body.pose
        pkl:
          params:
            path: '.'
            keys: 
              - translation
              - embedding
              - body.betas
              - body.rotation
              - body.left_hand
              - body.right_hand
              - body.jaw
              - body.pose
              - body.expression
      show_mesh_step:
        mesh:
          vertices: [body.vertices]
          faces: [body.faces]
          params:
            color: green
            path: fit/body/mesh/step
        mesh3d:
          vertices: [body.vertices, body.vertices]
          faces: [body.faces, body.faces]
          color: [green, blue]
          path: [fit/body/mesh/step, fit/body/mesh/step2]
      show_mesh_iter:
        mesh:
          vertices: [body.vertices]
          faces: [body.faces]
          params:
            color: cyan
            path: fit/body/mesh/iter
      show_mesh_batch:
        mesh:
          vertices: [body.vertices]
          faces: [body.faces]
          params:
            color: red
            path: fit/body/mesh/batch
    _metrics_:
      fit_quality:
        # frequency: 1
        rmse:
          gt: [keypoints]
          pred: [joints2d]
  _monitoring_:
    fit:
      step:
        initial_torso_fit:
          frequency: 1
          # steps:
            # - show_mesh
          tensors:
            - save_params
            - show_mesh_step
      iter:
        initial_torso_fit:
          frequency: 1
          # steps:
            # - show_mesh
          tensors:
            - show_mesh_iter
          metrics:
            - fit_quality
          termination: [bad_fit]
      batch:
        log_results:
          frequency: 1
          # steps: []
          metrics:
            - fit_quality
          tensors:
            - show_mesh_batch
# model:
  # validation:

  # monitors:
  #   metrics:
  #     fit_quality:
  #       # frequency: 1
  #       rmse:
  #         gt: [keypoints]
  #         pred: [joints2d]
  #   criteria:
  #     bad_fit:
  #       rmse:
  #         # gt: [keypoints]
  #         # pred: [joints2d]
  #         rmse: [metrics.rmse]
  #         threshold: [10000.3] # pixels
  #   tensors:
  #     save_params:
  #       append_pkl:
  #         path: ['.', '.hydra']
  #         keys: 
  #           -
  #             - translation
  #             - embedding
  #             - body.betas
  #             - body.rotation
  #             - body.left_hand
  #             - body.right_hand
  #             - body.jaw
  #             - body.pose
  #             - body.expression
  #           - 
  #             - body.pose
  #       pkl:
  #         params:
  #           path: '.'
  #           keys: 
  #             - translation
  #             - embedding
  #             - body.betas
  #             - body.rotation
  #             - body.left_hand
  #             - body.right_hand
  #             - body.jaw
  #             - body.pose
  #             - body.expression
  #     show_mesh_step:
  #       mesh:
  #         vertices: [body.vertices]
  #         faces: [body.faces]
  #         params:
  #           color: green
  #           path: fit/body/mesh/step
  #       mesh3d:
  #         vertices: [body.vertices, body.vertices]
  #         faces: [body.faces, body.faces]
  #         color: [green, blue]
  #         path: [fit/body/mesh/step, fit/body/mesh/step2]
  #     show_mesh_iter:
  #       mesh:
  #         vertices: [body.vertices]
  #         faces: [body.faces]
  #         params:
  #           color: cyan
  #           path: fit/body/mesh/iter
  #     show_mesh_batch:
  #       mesh:
  #         vertices: [body.vertices]
  #         faces: [body.faces]
  #         params:
  #           color: red
  #           path: fit/body/mesh/batch